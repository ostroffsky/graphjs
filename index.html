<!doctype html>
<html>
<head>
    <title>pathExample</title>
    <meta charset='utf-8' />
</head>
<body>

<canvas id='example'>Обновите браузер</canvas>


<script>
    var example = document.getElementById("example"),
            decorationsCtx     = example.getContext('2d'),
            axisCtx     = example.getContext('2d'),
            rullerCtx     = example.getContext('2d'),
            ctx     = example.getContext('2d');


    var data = [0,2,3,3,4,4,5,6,7,10,11,14,18,27,40,39,38,37,36, 5, 8, 10];

    var MAX = Math.max.apply(null, data),
        MIN = Math.min.apply(null, data);

    var PADDING = 30;

    var CANVAS_X0 = 0,
        CANVAS_Y0 = example.height;

    var CANVAS_HEIGHT = 480,
        CANVAS_WIDTH = 640;

    var X0 = PADDING,
        Y0 = CANVAS_HEIGHT - PADDING;

    var XMAX = CANVAS_WIDTH - PADDING,
        YMAX = PADDING;

    var DATA_HEIGHT = Y0 - YMAX,
        DATA_WIDTH = XMAX - X0;

    var LENGTH = data.length;
    var STEPX = DATA_WIDTH / LENGTH;

    function drawStroke() {
        // draw border
        decorationsCtx.strokeStyle = "#ccc";
        decorationsCtx.strokeRect(0, 0, example.width, example.height);

    }

    function drawAxis() {
        var x = example.width - PADDING;
        var y = PADDING;
        axisCtx.beginPath();
        axisCtx.moveTo(X0, y);
        axisCtx.lineTo(X0, Y0);
        axisCtx.lineTo(x, Y0);

        axisCtx.strokeStyle = "#777";
        axisCtx.stroke();

        axisCtx.textBaseline = "top";
        axisCtx.textAlign = "right";

        for (var i = 1; i < LENGTH; i++) {
            x = getCoordinatesByValue(i, data[i]).x;
            drawVerticalRuller(x);

            axisCtx.fillText(i, x, Y0 + 5, STEPX)
        }

        var step = (MAX - MIN) / LENGTH;
        for (var i = MIN; i < MAX; i += step) {
            y = getCoordinatesByValue(i, i).y;
            i = Math.round(i);

            drawHorizontalRuller(y);
            axisCtx.fillText(i, X0 - 5, y);
        }
    }

    function initCanvas() {
        example.height = CANVAS_HEIGHT;
        example.width  = CANVAS_WIDTH;
    }

    function drawData() {
        ctx.beginPath();

        for (var i = 0; i < LENGTH; i++) {
            var coordinate = getCoordinatesByValue(i, data[i]);
            x = coordinate.x;
            y = coordinate.y;

            // потенциально узкое место
            if (i==0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }
        }
        ctx.strokeStyle = "green";
        ctx.stroke();
    }

    function getCoordinatesByValue(x, fx) {
        var x = X0 + x * STEPX;
        var y = Y0 - fx * DATA_HEIGHT / MAX;

        return {
            "x": x,
            "y": y
        }
    }

    function drawVerticalRuller(x) {
        rullerCtx.beginPath();
        rullerCtx.moveTo(x, Y0);
        rullerCtx.lineTo(x, YMAX);

        rullerCtx.strokeStyle = "#eeeeee";
        rullerCtx.stroke();
    }

    function drawHorizontalRuller(y) {
        rullerCtx.beginPath();
        rullerCtx.moveTo(X0, y);
        rullerCtx.lineTo(XMAX, y);

        rullerCtx.strokeStyle = "#eeeeee";
        rullerCtx.stroke();
    }

    function getMax(array, index) {
        return result = array.reduce(function(max, arr) {
            return max >= arr[index] ? max : arr[index];
        }, -Infinity);
    }

    function getMin(array, index) {
        return result = array.reduce(function(max, arr) {
            return min <= arr[index] ? min : arr[index];
        }, -Infinity);
    }

    initCanvas();
    drawStroke();
    drawAxis();
    drawData();


</script>

<script src='http://172.18.67.45:3000/socket.io/socket.io.js'></script>
<script src='http://172.18.67.45:3001/browser-sync-client.min.js'></script>
</body>
</html>